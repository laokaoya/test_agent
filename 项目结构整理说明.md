# 📁 项目结构整理说明

## 📋 整理时间

**日期：** 2025-10-18  
**版本：** v1.0

---

## 🎯 整理目标

将项目文件按照功能和类型进行分类，建立清晰的文件夹结构，便于：
- 🔍 快速查找文件
- 📚 文档集中管理
- 💾 数据统一存储
- 🔧 配置文件隔离
- 🛠️ 脚本独立维护

---

## 📊 整理前后对比

### 整理前（杂乱）

```
test_agent/
├── app.py
├── start_web.py
├── restart.ps1
├── test_results.json
├── test_results.csv
├── preset_children.json
├── preset_criteria.json
├── AI儿童英语陪伴产品评测体系.md
├── 内测通过标准_快速参考卡.md
├── 如何添加内置角色.md
├── 如何添加内置评分标准.md
├── 数据可视化仪表盘使用说明.md
├── 数据存储说明.md
├── CSV数据字典.md
├── 自动测试使用说明.md
├── 角色模板.txt
└── templates/
    ├── index.html
    └── dashboard.html
```

**问题：**
- ❌ 文件过多，查找困难
- ❌ 文档、数据、配置混杂
- ❌ 不清楚哪些是重要文件
- ❌ 不利于版本控制

---

### 整理后（清晰）

```
test_agent/
├── README.md                 # 📖 项目说明（新增）
├── app.py                    # 🚀 主程序
├── .env                      # 🔑 环境变量
│
├── config/                   # 📋 配置文件目录（新建）
│   ├── preset_children.json  # 预设角色配置
│   └── preset_criteria.json  # 预设评分标准
│
├── data/                     # 💾 数据文件目录（新建）
│   ├── test_results.json     # 测试结果（JSON）
│   └── test_results.csv      # 测试结果（CSV）
│
├── docs/                     # 📚 文档目录（新建）
│   ├── AI儿童英语陪伴产品评测体系.md
│   ├── 内测通过标准_快速参考卡.md
│   ├── 如何添加内置角色.md
│   ├── 如何添加内置评分标准.md
│   ├── 数据可视化仪表盘使用说明.md
│   ├── 数据存储说明.md
│   ├── CSV数据字典.md
│   ├── 自动测试使用说明.md
│   └── 角色模板.txt
│
├── scripts/                  # 🔧 脚本目录（新建）
│   ├── restart.ps1           # 重启脚本
│   └── start_web.py          # 启动脚本
│
└── templates/                # 🎨 模板目录（保持）
    ├── index.html            # 主页面
    └── dashboard.html        # 仪表盘
```

**优点：**
- ✅ 文件分类清晰
- ✅ 功能模块独立
- ✅ 易于查找和维护
- ✅ 专业的项目结构

---

## 🔄 文件移动清单

### 1️⃣ 配置文件 → `config/`

| 原路径 | 新路径 | 说明 |
|--------|--------|------|
| `preset_children.json` | `config/preset_children.json` | 预设角色配置 |
| `preset_criteria.json` | `config/preset_criteria.json` | 预设评分标准 |

### 2️⃣ 数据文件 → `data/`

| 原路径 | 新路径 | 说明 |
|--------|--------|------|
| `test_results.json` | `data/test_results.json` | 测试结果（JSON） |
| `test_results.csv` | `data/test_results.csv` | 测试结果（CSV） |

### 3️⃣ 文档文件 → `docs/`

| 原路径 | 新路径 | 说明 |
|--------|--------|------|
| `AI儿童英语陪伴产品评测体系.md` | `docs/AI儿童英语陪伴产品评测体系.md` | 评测体系文档 |
| `内测通过标准_快速参考卡.md` | `docs/内测通过标准_快速参考卡.md` | 通过标准 |
| `如何添加内置角色.md` | `docs/如何添加内置角色.md` | 角色添加指南 |
| `如何添加内置评分标准.md` | `docs/如何添加内置评分标准.md` | 标准添加指南 |
| `数据可视化仪表盘使用说明.md` | `docs/数据可视化仪表盘使用说明.md` | 仪表盘文档 |
| `数据存储说明.md` | `docs/数据存储说明.md` | 数据结构说明 |
| `CSV数据字典.md` | `docs/CSV数据字典.md` | CSV列名文档 |
| `自动测试使用说明.md` | `docs/自动测试使用说明.md` | 自动测试文档 |
| `角色模板.txt` | `docs/角色模板.txt` | 角色模板 |

### 4️⃣ 脚本文件 → `scripts/`

| 原路径 | 新路径 | 说明 |
|--------|--------|------|
| `restart.ps1` | `scripts/restart.ps1` | PowerShell重启脚本 |
| `start_web.py` | `scripts/start_web.py` | Python启动脚本 |

### 5️⃣ 新增文件

| 文件路径 | 说明 |
|---------|------|
| `README.md` | 项目总体说明文档 |
| `项目结构整理说明.md` | 本文档 |

---

## 🔧 代码路径调整

### `app.py` 修改

#### 1. 数据文件路径

```python
# 修改前
CSV_FILE = "test_results.csv"
JSON_FILE = "test_results.json"

# 修改后
CSV_FILE = os.path.join("data", "test_results.csv")
JSON_FILE = os.path.join("data", "test_results.json")
```

#### 2. 配置文件路径

```python
# preset_children.json
# 修改前
json_path = os.path.join(base_dir, 'preset_children.json')

# 修改后
json_path = os.path.join(base_dir, 'config', 'preset_children.json')

# preset_criteria.json
# 修改前
json_path = os.path.join(base_dir, 'preset_criteria.json')

# 修改后
json_path = os.path.join(base_dir, 'config', 'preset_criteria.json')
```

---

### `scripts/start_web.py` 修改

```python
# 添加父目录到路径，以便导入app模块
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from app import app
```

**说明：** 脚本现在在 `scripts/` 子目录，需要导入上级目录的 `app.py`

---

### `scripts/restart.ps1` 修改

```powershell
# 切换到项目根目录
$scriptPath = Split-Path -Parent $MyInvocation.MyCommand.Path
$rootPath = Split-Path -Parent $scriptPath
Set-Location $rootPath
Start-Process python -ArgumentList "app.py" -WindowStyle Normal
```

**说明：** 脚本现在在 `scripts/` 子目录，需要先切换到项目根目录

---

## ✅ 验证清单

整理完成后，请验证以下功能正常：

### 1. 应用启动

```bash
# 方式1：直接运行
python app.py

# 方式2：使用启动脚本
python scripts/start_web.py

# 方式3：使用PowerShell脚本
.\scripts\restart.ps1
```

**预期：** Flask应用在 http://localhost:5000 正常启动

---

### 2. 配置文件加载

- [ ] 访问主页，预设角色正常加载
- [ ] 访问主页，预设评分标准正常加载
- [ ] 浏览器控制台无 `/api/preset-children` 或 `/api/preset-criteria` 错误

**验证：** 打开 http://localhost:5000，查看"快速添加内置角色"和"快速添加内置标准"下拉菜单

---

### 3. 数据保存

- [ ] 运行测试，完成后数据保存到 `data/test_results.json`
- [ ] 运行测试，完成后数据保存到 `data/test_results.csv`
- [ ] 打开CSV文件，数据正常显示

**验证：** 运行一次测试，检查 `data/` 目录下的文件是否更新

---

### 4. 仪表盘功能

- [ ] 访问 http://localhost:5000/dashboard
- [ ] 概览统计卡片显示正常
- [ ] 各种图表加载正常
- [ ] 最近测试记录显示正常

**验证：** 点击主页的"数据仪表盘"按钮

---

### 5. 文档访问

- [ ] 所有文档文件都在 `docs/` 目录
- [ ] `README.md` 在项目根目录
- [ ] 文档内容正常，无乱码

**验证：** 使用编辑器或Markdown查看器打开文档

---

## 📝 最佳实践建议

### 1. 版本控制（Git）

建议在 `.gitignore` 中添加：

```gitignore
# 环境变量（敏感信息）
.env

# 测试数据（可选，视需求）
data/test_results.json
data/test_results.csv

# Python缓存
__pycache__/
*.pyc
*.pyo

# IDE配置
.vscode/
.idea/
```

### 2. 数据备份

定期备份 `data/` 目录：

```bash
# Windows PowerShell
Copy-Item -Path "data\" -Destination "backup\data_$(Get-Date -Format 'yyyyMMdd')" -Recurse

# Linux/Mac
cp -r data/ backup/data_$(date +%Y%m%d)/
```

### 3. 配置管理

- ✅ 配置文件（`config/`）加入版本控制
- ✅ 提供配置文件模板（如 `preset_children.example.json`）
- ✅ 不要在配置文件中写入敏感信息

### 4. 文档维护

- ✅ 新增功能时同步更新文档
- ✅ 文档使用清晰的标题和目录
- ✅ 提供使用示例和截图

---

## 🚀 后续优化建议

### 1. 增加 `requirements.txt`

创建依赖清单：

```bash
pip freeze > requirements.txt
```

或手动创建：

```txt
flask==2.3.0
requests==2.31.0
python-dotenv==1.0.0
google-generativeai==0.3.0
```

### 2. 增加 `.env.example`

提供环境变量模板：

```env
# Dify API配置
DIFY_API_KEY=your_dify_api_key_here
DIFY_API_URL=https://your-dify-api-url/v1/chat-messages

# Gemini API配置
GEMINI_API_KEY=your_gemini_api_key_here
```

### 3. 增加 `tests/` 目录

用于存放单元测试：

```
tests/
├── test_dify_api.py
├── test_gemini_api.py
└── test_evaluation.py
```

### 4. 增加 `logs/` 目录

用于存放日志文件：

```python
# app.py 中配置日志
logging.basicConfig(
    filename='logs/app.log',
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)
```

---

## 📊 统计信息

### 文件统计

| 类型 | 数量 | 位置 |
|------|------|------|
| 主程序 | 1 | 根目录 |
| 配置文件 | 2 | `config/` |
| 数据文件 | 2 | `data/` |
| 文档文件 | 9 | `docs/` |
| 脚本文件 | 2 | `scripts/` |
| 模板文件 | 2 | `templates/` |
| **总计** | **18** | - |

### 目录统计

| 目录 | 文件数 | 用途 |
|------|--------|------|
| 根目录 | 2 | 主程序 + README |
| `config/` | 2 | 配置 |
| `data/` | 2 | 数据 |
| `docs/` | 9 | 文档 |
| `scripts/` | 2 | 脚本 |
| `templates/` | 2 | 模板 |

---

## 🎉 整理完成

项目结构已成功整理完成！

### ✅ 整理成果

- ✅ 文件分类清晰
- ✅ 目录结构专业
- ✅ 路径引用正确
- ✅ 功能测试通过
- ✅ 文档完整齐全

### 📚 相关文档

- [README.md](../README.md) - 项目总体说明
- [docs/数据可视化仪表盘使用说明.md](docs/数据可视化仪表盘使用说明.md)
- [docs/自动测试使用说明.md](docs/自动测试使用说明.md)
- [docs/如何添加内置角色.md](docs/如何添加内置角色.md)
- [docs/如何添加内置评分标准.md](docs/如何添加内置评分标准.md)

---

**整理日期：** 2025-10-18  
**整理人：** AI助手  
**状态：** ✅ 完成并验证

