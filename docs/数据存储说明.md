# ğŸ“Š æ•°æ®å­˜å‚¨è¯´æ˜

## ğŸ¯ æ¦‚è¿°

æµ‹è¯•ç»“æœé‡‡ç”¨ **åŒæ ¼å¼å­˜å‚¨**ï¼š
- **JSONæ–‡ä»¶**ï¼šä¿å­˜å®Œæ•´çš„ç»“æ„åŒ–æ•°æ®ï¼Œä¾¿äºç¨‹åºè¯»å–å’Œå¤„ç†
- **CSVæ–‡ä»¶**ï¼šä¿å­˜ç®€åŒ–æ•°æ®ï¼Œä¾¿äºExcelæŸ¥çœ‹å’Œå¿«é€Ÿåˆ†æ

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

### 1ï¸âƒ£ JSON æ–‡ä»¶ï¼š`test_results.json`

**ç”¨é€”ï¼š** å®Œæ•´çš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨

**æ ¼å¼ï¼š** JSONæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€æ¡æµ‹è¯•è®°å½•

**ç‰¹ç‚¹ï¼š**
- âœ… ä¿å­˜å®Œæ•´çš„å¯¹è¯è®°å½•
- âœ… ç»“æ„åŒ–çš„è¯„åˆ†æ•°æ®
- âœ… è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
- âœ… ä¾¿äºç¨‹åºè¯»å–å’Œåˆ†æ
- âœ… æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œæ•°æ®å¤„ç†

**ç¤ºä¾‹ç»“æ„ï¼š**

```json
[
  {
    "test_id": "20251018_150000_å°ç†Š",
    "timestamp": "2025-10-18 15:00:00",
    "test_date": "2025-10-18",
    "child": {
      "name": "å°ç†Š",
      "age": 5,
      "type": "å®³ç¾å‹",
      "traits": "## è§’è‰²æ€§æ ¼\n- æ€§æ ¼æ¯”è¾ƒå®³ç¾...",
      "opening": "Hello... I'm shy."
    },
    "conversations": [
      {
        "user_message": "Hello... I'm shy.",
        "ai_response": "Hi there! It's okay to be shy..."
      },
      {
        "user_message": "I like cats.",
        "ai_response": "That's wonderful! Cats are amazing..."
      }
    ],
    "rounds": 3,
    "scores": {
      "individual": {
        "å¼€å£å‹‡æ°”": 6,
        "ä¸»åŠ¨è¡¨è¾¾": 5,
        "æƒ…ç»ªå›åº”": 7
      },
      "average": 6.0,
      "max": 7,
      "min": 5,
      "std_dev": 0.82,
      "criteria_used": ["å¼€å£å‹‡æ°”", "ä¸»åŠ¨è¡¨è¾¾", "æƒ…ç»ªå›åº”"]
    },
    "evaluation": {
      "reason": "ä»å­©å­çš„è§’åº¦çœ‹ï¼ŒAIçš„ä¸»è¦é—®é¢˜æ˜¯...",
      "lessons": "ã€æ”¹è¿›å»ºè®®ã€‘åˆ†æ¡åˆ—å‡ºï¼š\n1. âŒ ä¸»è¦é—®é¢˜...",
      "character_review": "æˆ‘è§‰å¾—...æœ‰ç‚¹..."
    },
    "statistics": {
      "total_chars_child": 45,
      "total_chars_ai": 180,
      "avg_chars_child": 15.0,
      "avg_chars_ai": 60.0
    }
  }
]
```

**æ•°æ®å­—å…¸ï¼š**

| å­—æ®µè·¯å¾„ | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| `test_id` | String | å”¯ä¸€æµ‹è¯•æ ‡è¯†ç¬¦ |
| `timestamp` | DateTime | å®Œæ•´æ—¶é—´æˆ³ |
| `test_date` | Date | æµ‹è¯•æ—¥æœŸ |
| `child.name` | String | è§’è‰²åç§° |
| `child.age` | Integer | è§’è‰²å¹´é¾„ |
| `child.type` | String | è§’è‰²ç±»å‹ |
| `child.traits` | String | å®Œæ•´æ€§æ ¼è®¾å®š |
| `child.opening` | String | å¼€åœºç™½ |
| `conversations[].user_message` | String | å­©å­æ¶ˆæ¯ |
| `conversations[].ai_response` | String | AIå›å¤ |
| `rounds` | Integer | å¯¹è¯è½®æ•° |
| `scores.individual` | Object | å„é¡¹è¯„åˆ†è¯¦æƒ… |
| `scores.average` | Float | å¹³å‡åˆ† |
| `scores.max` | Integer | æœ€é«˜åˆ† |
| `scores.min` | Integer | æœ€ä½åˆ† |
| `scores.std_dev` | Float | æ ‡å‡†å·® |
| `scores.criteria_used` | Array | ä½¿ç”¨çš„è¯„åˆ†æ ‡å‡†åˆ—è¡¨ |
| `evaluation.reason` | String | è¯„åˆ†æ€»ä½“ç†ç”± |
| `evaluation.lessons` | String | ç»éªŒæ•™è®­ |
| `evaluation.character_review` | String | è§’è‰²è‡ªè¿° |
| `statistics.total_chars_child` | Integer | å­©å­æ€»å­—æ•° |
| `statistics.total_chars_ai` | Integer | AIæ€»å­—æ•° |
| `statistics.avg_chars_child` | Float | å­©å­å¹³å‡å­—æ•° |
| `statistics.avg_chars_ai` | Float | AIå¹³å‡å­—æ•° |

---

### 2ï¸âƒ£ CSV æ–‡ä»¶ï¼š`test_results.csv`

**ç”¨é€”ï¼š** ç®€åŒ–æ•°æ®ï¼Œä¾¿äºExcelæŸ¥çœ‹

**æ ¼å¼ï¼š** æ ‡å‡†CSVï¼ŒUTF-8 with BOMç¼–ç 

**ç‰¹ç‚¹ï¼š**
- âœ… å›ºå®šåˆ—ç»“æ„ï¼ˆ52åˆ—ï¼‰
- âœ… Excelå®Œç¾å…¼å®¹
- âœ… è¯„åˆ†æ•°æ®ç”¨JSONå­—ç¬¦ä¸²å­˜å‚¨
- âœ… ä¾¿äºå¿«é€Ÿæµè§ˆå’ŒåŸºç¡€ç»Ÿè®¡
- âœ… æ”¯æŒæ•°æ®é€è§†è¡¨

**åˆ—ç»“æ„ï¼š**

#### åŸºç¡€ä¿¡æ¯ï¼ˆ7åˆ—ï¼‰
| åˆ—å | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| æµ‹è¯•ID | String | å”¯ä¸€æ ‡è¯†ç¬¦ |
| æµ‹è¯•æ—¶é—´ | DateTime | å®Œæ•´æ—¶é—´æˆ³ |
| æµ‹è¯•æ—¥æœŸ | Date | æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |
| è§’è‰²åç§° | String | è§’è‰²å |
| è§’è‰²ç±»å‹ | String | å®³ç¾å‹/è¯å¤šå‹ç­‰ |
| è§’è‰²å¹´é¾„ | Integer | å¹´é¾„ |
| å¯¹è¯è½®æ•° | Integer | å®é™…è½®æ•° |

#### å¯¹è¯å†…å®¹ï¼ˆ1åˆ—ï¼ŒJSONæ ¼å¼ï¼‰
| åˆ—å | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| å¯¹è¯è®°å½•_JSON | String(JSON) | **æ‰€æœ‰å¯¹è¯è½®æ¬¡ï¼ˆJSONæ•°ç»„ï¼‰** |

> **JSONæ ¼å¼ç¤ºä¾‹ï¼š**
> ```json
> [
>   {"round": 1, "child_message": "Hello...", "ai_response": "Hi there!", "child_chars": 8, "ai_chars": 10},
>   {"round": 2, "child_message": "I like cats.", "ai_response": "That's wonderful!", "child_chars": 13, "ai_chars": 16},
>   {"round": 3, "child_message": "Tell me more.", "ai_response": "Sure! Cats are...", "child_chars": 14, "ai_chars": 17}
> ]
> ```

#### è¯„åˆ†æ•°æ®ï¼ˆ6åˆ—ï¼‰
| åˆ—å | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| è¯„åˆ†è¯¦æƒ…_JSON | String(JSON) | **å„é¡¹è¯„åˆ†ï¼ˆJSONæ ¼å¼ï¼‰** |
| è¯„åˆ†_å¹³å‡åˆ† | Float | å¹³å‡åˆ† |
| è¯„åˆ†_æœ€é«˜åˆ† | Integer | æœ€é«˜åˆ† |
| è¯„åˆ†_æœ€ä½åˆ† | Integer | æœ€ä½åˆ† |
| è¯„åˆ†_æ ‡å‡†å·® | Float | æ ‡å‡†å·® |
| ä½¿ç”¨çš„è¯„åˆ†æ ‡å‡† | String | æ ‡å‡†åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ |

> **é‡è¦ï¼š** `è¯„åˆ†è¯¦æƒ…_JSON` åˆ—å­˜å‚¨çš„æ˜¯JSONå­—ç¬¦ä¸²ï¼Œå¦‚ï¼š`{"å¼€å£å‹‡æ°”": 6, "ä¸»åŠ¨è¡¨è¾¾": 5, "æƒ…ç»ªå›åº”": 7}`
> 
> åœ¨Excelä¸­å¯ä»¥ï¼š
> - ç›´æ¥æŸ¥çœ‹åŸå§‹JSON
> - ä½¿ç”¨Excelçš„Power Queryè§£æJSON
> - ä½¿ç”¨Python/Rè¯»å–å¹¶è§£æ

#### å¯¹è¯ç»Ÿè®¡ï¼ˆ4åˆ—ï¼‰
| åˆ—å | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| æ€»å­—æ•°_å­©å­ | Integer | å­©å­æ€»å­—æ•° |
| æ€»å­—æ•°_AI | Integer | AIæ€»å­—æ•° |
| å¹³å‡å­—æ•°_å­©å­ | Float | å¹³å‡æ¯è½®å­—æ•° |
| å¹³å‡å­—æ•°_AI | Float | å¹³å‡æ¯è½®å­—æ•° |

#### è¯„ä»·å†…å®¹ï¼ˆ3åˆ—ï¼‰
| åˆ—å | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| è¯„åˆ†ç†ç”±_æ€»ä½“ | Text | æ€»ä½“è¯„ä»· |
| ç»éªŒæ•™è®­ | Text | æ”¹è¿›å»ºè®® |
| è§’è‰²è‡ªè¿° | Text | è§’è‰²è§†è§’è¯„ä»· |

#### å…ƒæ•°æ®ï¼ˆ2åˆ—ï¼‰
| åˆ—å | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| è§’è‰²å®Œæ•´è®¾å®š | Text | å®Œæ•´traits |
| å¼€åœºç™½ | String | opening |

**æ€»åˆ—æ•°ï¼š** 7 + 1 + 7 + 4 + 3 + 2 = **14åˆ—ï¼ˆå›ºå®šï¼‰**

> âœ¨ **é‡å¤§ç®€åŒ–ï¼š** åŸ40åˆ—å¯¹è¯æ•°æ®ç°åœ¨åˆå¹¶ä¸º1åˆ—JSONï¼Œé¿å…å¤§é‡ç©ºåˆ—ï¼

---

## ğŸ“ˆ ä½¿ç”¨åœºæ™¯å¯¹æ¯”

### JSON é€‚ç”¨åœºæ™¯

1. **ç¨‹åºåŒ–æ•°æ®å¤„ç†**
   ```python
   import json
   with open('test_results.json', 'r', encoding='utf-8') as f:
       data = json.load(f)
   
   # ç›´æ¥è®¿é—®ç»“æ„åŒ–æ•°æ®
   for record in data:
       print(f"{record['child']['name']}: {record['scores']['average']}")
   ```

2. **å¤æ‚æŸ¥è¯¢**
   ```python
   # æ‰¾å‡ºæ‰€æœ‰å®³ç¾å‹è§’è‰²çš„å¹³å‡åˆ†
   shy_scores = [r['scores']['average'] for r in data 
                 if r['child']['type'] == 'å®³ç¾å‹']
   ```

3. **æ•°æ®å¯¼å‡ºå’Œé›†æˆ**
   - ä¾¿äºå¯¼å…¥åˆ°æ•°æ®åº“
   - ä¾¿äºAPIæ¥å£ä¼ è¾“
   - ä¾¿äºä¸å…¶ä»–ç³»ç»Ÿé›†æˆ

### CSV é€‚ç”¨åœºæ™¯

1. **Excelå¿«é€ŸæŸ¥çœ‹**
   - ç›´æ¥åŒå‡»æ‰“å¼€
   - ä½¿ç”¨ç­›é€‰åŠŸèƒ½
   - åˆ›å»ºå›¾è¡¨

2. **æ•°æ®é€è§†è¡¨**
   ```
   æŒ‰è§’è‰²ç±»å‹åˆ†ç»„ â†’ å¹³å‡è¯„åˆ†
   æŒ‰æ—¥æœŸåˆ†ç»„ â†’ è¶‹åŠ¿åˆ†æ
   ```

3. **å¿«é€Ÿç»Ÿè®¡**
   - SUMã€AVERAGEã€MAXã€MIN
   - æ¡ä»¶æ ¼å¼åŒ–
   - ç®€å•å›¾è¡¨

4. **JSONåˆ—è§£æç¤ºä¾‹**
   
   **è§£æå¯¹è¯è®°å½•ï¼š**
   ```python
   import pandas as pd
   import json
   
   df = pd.read_csv('test_results.csv', encoding='utf-8-sig')
   
   # è§£æå¯¹è¯JSON
   df['å¯¹è¯è®°å½•'] = df['å¯¹è¯è®°å½•_JSON'].apply(json.loads)
   
   # æå–ç¬¬ä¸€è½®å¯¹è¯
   df['ç¬¬1è½®_å­©å­'] = df['å¯¹è¯è®°å½•'].apply(lambda x: x[0]['child_message'] if len(x) > 0 else '')
   df['ç¬¬1è½®_AI'] = df['å¯¹è¯è®°å½•'].apply(lambda x: x[0]['ai_response'] if len(x) > 0 else '')
   
   # æˆ–è€…å±•å¼€æ‰€æœ‰å¯¹è¯ä¸ºå•ç‹¬çš„è¡Œ
   conversations_df = df.explode('å¯¹è¯è®°å½•')
   conversations_df['round'] = conversations_df['å¯¹è¯è®°å½•'].apply(lambda x: x['round'])
   conversations_df['child_message'] = conversations_df['å¯¹è¯è®°å½•'].apply(lambda x: x['child_message'])
   conversations_df['ai_response'] = conversations_df['å¯¹è¯è®°å½•'].apply(lambda x: x['ai_response'])
   ```
   
   **è§£æè¯„åˆ†è¯¦æƒ…ï¼š**
   ```python
   # è§£æè¯„åˆ†JSON
   df['è¯„åˆ†è¯¦æƒ…'] = df['è¯„åˆ†è¯¦æƒ…_JSON'].apply(json.loads)
   
   # å±•å¼€ä¸ºç‹¬ç«‹åˆ—
   scores_df = pd.json_normalize(df['è¯„åˆ†è¯¦æƒ…'])
   df = pd.concat([df, scores_df], axis=1)
   ```

---

## ğŸ”„ æ•°æ®åŒæ­¥

**ä¿å­˜æµç¨‹ï¼š**

1. å‰ç«¯å®Œæˆæµ‹è¯•å¹¶è°ƒç”¨ `/api/save-result`
2. åç«¯åŒæ—¶ä¿å­˜åˆ°ï¼š
   - `test_results.json`ï¼ˆè¿½åŠ æ¨¡å¼ï¼Œå®Œæ•´æ•°æ®ï¼‰
   - `test_results.csv`ï¼ˆè¿½åŠ æ¨¡å¼ï¼Œç®€åŒ–æ•°æ®ï¼‰
3. è¿”å›æˆåŠŸæ¶ˆæ¯

**ä¸€è‡´æ€§ä¿è¯ï¼š**
- ä½¿ç”¨çº¿ç¨‹é”ï¼ˆ`file_lock`ï¼‰ç¡®ä¿å¹¶å‘å®‰å…¨
- ä¸¤ä¸ªæ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„ `test_id` å…³è”
- å¦‚æœä¸€ä¸ªä¿å­˜å¤±è´¥ï¼Œå¦ä¸€ä¸ªä»ä¼šä¿å­˜

---

## ğŸ’¡ æœ€ä½³å®è·µ

### æ—¥å¸¸ä½¿ç”¨å»ºè®®

1. **å¿«é€ŸæŸ¥çœ‹ â†’ ä½¿ç”¨ CSV**
   - ç”¨Excelæ‰“å¼€æŸ¥çœ‹æœ€è¿‘æµ‹è¯•
   - ä½¿ç”¨ç­›é€‰åŠŸèƒ½æŸ¥æ‰¾ç‰¹å®šè§’è‰²
   - åˆ›å»ºç®€å•çš„å›¾è¡¨

2. **æ·±åº¦åˆ†æ â†’ ä½¿ç”¨ JSON**
   - Python/Rè„šæœ¬è¿›è¡Œæ•°æ®åˆ†æ
   - åˆ›å»ºè‡ªå®šä¹‰ç»Ÿè®¡æŠ¥å‘Š
   - å¯¼å…¥åˆ°æ•°æ®åº“åšå¤æ‚æŸ¥è¯¢

3. **è¯„åˆ†è¯¦æƒ…åˆ†æ**
   - **ç®€å•æŸ¥çœ‹ï¼š** åœ¨CSVä¸­ç›´æ¥çœ‹JSONå­—ç¬¦ä¸²
   - **è¯¦ç»†åˆ†æï¼š** ç”¨Pythonè§£æJSONåˆ—
   - **å…¨é¢åˆ†æï¼š** ç›´æ¥è¯»å–JSONæ–‡ä»¶

### Excelä¸­è§£æè¯„åˆ†è¯¦æƒ…

**æ–¹æ³•1ï¼šPower Query**
1. æ‰“å¼€CSVæ–‡ä»¶
2. é€‰æ‹© `è¯„åˆ†è¯¦æƒ…_JSON` åˆ—
3. æ•°æ® â†’ ä»æ–‡æœ¬/CSV â†’ JSON
4. å±•å¼€ä¸ºåˆ—

**æ–¹æ³•2ï¼šPythonè„šæœ¬**
```python
import pandas as pd
import json

# è¯»å–CSV
df = pd.read_csv('test_results.csv', encoding='utf-8-sig')

# è§£æè¯„åˆ†JSON
def parse_scores(json_str):
    try:
        return json.loads(json_str)
    except:
        return {}

df['è¯„åˆ†è¯¦æƒ…'] = df['è¯„åˆ†è¯¦æƒ…_JSON'].apply(parse_scores)

# å±•å¼€ä¸ºç‹¬ç«‹åˆ—
scores_df = pd.json_normalize(df['è¯„åˆ†è¯¦æƒ…'])
result = pd.concat([df.drop('è¯„åˆ†è¯¦æƒ…', axis=1), scores_df], axis=1)

# ä¿å­˜ä¸ºæ–°çš„CSVï¼ˆå¸¦è¯„åˆ†åˆ—ï¼‰
result.to_csv('test_results_expanded.csv', index=False, encoding='utf-8-sig')
```

---

## ğŸ“ æ•°æ®å¤‡ä»½å»ºè®®

1. **å®šæœŸå¤‡ä»½**
   - JSONæ–‡ä»¶ï¼šå®Œæ•´å¤‡ä»½
   - CSVæ–‡ä»¶ï¼šå¯é€‰å¤‡ä»½

2. **ç‰ˆæœ¬æ§åˆ¶**
   - ä½¿ç”¨æ—¥æœŸå‘½åå¤‡ä»½æ–‡ä»¶
   - ä¾‹å¦‚ï¼š`test_results_20251018.json`

3. **äº‘ç«¯åŒæ­¥**
   - å®šæœŸä¸Šä¼ åˆ°äº‘å­˜å‚¨
   - é˜²æ­¢æ•°æ®ä¸¢å¤±

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- `CSVæ•°æ®å­—å…¸.md` - CSVè¯¦ç»†åˆ—åè¯´æ˜
- `preset_children.json` - è§’è‰²é…ç½®
- `preset_criteria.json` - è¯„åˆ†æ ‡å‡†é…ç½®
- `å¦‚ä½•æ·»åŠ å†…ç½®è§’è‰².md` - è§’è‰²æ·»åŠ æŒ‡å—
- `å¦‚ä½•æ·»åŠ å†…ç½®è¯„åˆ†æ ‡å‡†.md` - è¯„åˆ†æ ‡å‡†æŒ‡å—

---

**æ–‡ä»¶ä½ç½®ï¼š** `d:\test_agent\`  
**æœ€åæ›´æ–°ï¼š** 2025-10-18  
**ç‰ˆæœ¬ï¼š** 2.0 (JSON + CSVåŒæ ¼å¼)

